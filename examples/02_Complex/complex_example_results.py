"""
This script shows how to load results of a prior optimization and how to analyze them.
"""

import flixopt as fx

if __name__ == '__main__':
    fx.CONFIG.exploring()

    # --- Load FlowSystem with Solution ---
    try:
        flow_system = fx.FlowSystem.from_netcdf('results/complex_example.nc')
    except FileNotFoundError as e:
        raise FileNotFoundError(
            f"Results file not found ('results/complex_example.nc'). "
            f"Please ensure that the file is generated by running 'complex_example.py'. "
            f'Original error: {e}'
        ) from e

    # --- Basic overview ---
    flow_system.topology.plot()
    flow_system.statistics.plot.balance('Fernwärme')

    # --- Detailed Plots ---
    # In-depth plot for individual flow rates
    flow_system.statistics.plot.heatmap('Wärmelast(Q_th_Last)|flow_rate')

    # Plot balances for all buses
    for bus in flow_system.buses.values():
        flow_system.statistics.plot.balance(bus.label).to_html(f'results/{bus.label}--balance.html')

    # --- Plotting internal variables manually ---
    flow_system.statistics.plot.heatmap('BHKW2(Q_th)|status')
    flow_system.statistics.plot.heatmap('Kessel(Q_th)|status')

    # Access data as DataFrames:
    print(flow_system.statistics.flow_rates.to_dataframe())
    print(flow_system.solution.to_dataframe())
